  <script>
    // NƒÉm hi·ªán t·∫°i
    document.getElementById("year").textContent = new Date().getFullYear();

    // URL web app Apps Script
    const NEWS_API_URL = "https://script.google.com/macros/s/AKfycby6Wp2o149SK_obUpY6qyE8RN4bFTr3HDBanCXQ-lTZS-qeNDlOi3Ce7nGow6Ar-mmZPQ/exec";
    const API_URL = NEWS_API_URL; // d√πng chung

    /* ========= TIN T·ª®C (module=hoatdong) ========= */
    function renderNews(items) {
      const container = document.getElementById("news-list");
      if (!container) return;

      container.innerHTML = ""; // x√≥a n·ªôi dung c≈©

      items.forEach(item => {
        const article = document.createElement("article");
        article.className = "news-item";

        article.innerHTML = `
          <div class="news-header">
            <h4>${item.chuongTrinh || ""}</h4>
            <span class="news-type">${item.tagLoai || item.loai || ""}</span>
          </div>
          <div class="news-meta">${item.ngay || ""}</div>
          <p>${item.moTa || ""}</p>
        `;

        container.appendChild(article);
      });
    }

    const loadNews = async () => {
      try {
        const res = await fetch(NEWS_API_URL + "?module=hoatdong");
        const data = await res.json();
        const items = (data.items || []).slice(0, 3);
        renderNews(items);
      } catch (err) {
        console.error("L·ªói load tin t·ª©c:", err);
      }
    };

    /* ========= 1. TR·ª§ C·ªòT H·ªÜ SINH TH√ÅI (module=trucot) ========= */
    async function loadEcosystem() {
      const box = document.getElementById("ecosystem-grid");
      if (!box) return;
      try {
        const res  = await fetch(API_URL + "?module=trucot");
        const data = await res.json();
        const items = data.items || [];

        if (!items.length) {
          box.innerHTML = '<div style="font-size:0.85rem;color:#64748b;">Ch∆∞a c√≥ d·ªØ li·ªáu tr·ª• c·ªôt.</div>';
          return;
        }

        box.innerHTML = "";
        items.forEach(it => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <div class="card-icon">${it.icon || "üìå"}</div>
            <span>${it.nhom || ""}</span>
            <h3>${it.tieuDe || ""}</h3>
            <p>${it.moTa || ""}</p>
          `;
          box.appendChild(card);
        });
      } catch (err) {
        console.error("L·ªói load TruCot:", err);
        box.innerHTML = '<div style="font-size:0.85rem;color:#b91c1c;">Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu tr·ª• c·ªôt.</div>';
      }
    }

    /* ========= 2. GI·ªöI THI·ªÜU (module=gioithieu) ========= */
    async function loadGioiThieu() {
      try {
        const res  = await fetch(API_URL + "?module=gioithieu");
        const data = await res.json();
        const info = data.info || data; // h·ªó tr·ª£ c·∫£ 2 ki·ªÉu tr·∫£ v·ªÅ

        const titleEl = document.getElementById("gioithieu-title");
        const subEl   = document.getElementById("gioithieu-sub");
        const textEl  = document.getElementById("gioithieu-text");
        const listEl  = document.getElementById("gioithieu-list");

        if (titleEl && info.title)   titleEl.textContent = info.title;
        if (subEl && info.subtitle)  subEl.textContent   = info.subtitle;
        if (textEl && info.text)     textEl.textContent  = info.text;

        if (listEl && (info.suMenh || info.tamNhin || info.giaTri)) {
          listEl.innerHTML = `
            <li><strong>S·ª© m·ªánh:</strong> ${info.suMenh || ""}</li>
            <li><strong>T·∫ßm nh√¨n:</strong> ${info.tamNhin || ""}</li>
            <li><strong>Gi√° tr·ªã c·ªët l√µi:</strong> ${info.giaTri || ""}</li>
          `;
        }
      } catch (err) {
        console.error("L·ªói load GioiThieu:", err);
      }
    }

    /* ========= 3. Lƒ®NH V·ª∞C NGHI√äN C·ª®U (module=linhvuc) ========= */
    async function loadLinhVuc() {
      try {
        const res  = await fetch(API_URL + "?module=linhvuc");
        const data = await res.json();
        const info = data.info || data;

        const titleEl = document.getElementById("linhvuc-title");
        const subEl   = document.getElementById("linhvuc-sub");
        const textEl  = document.getElementById("linhvuc-text");
        const tagsEl  = document.getElementById("linhvuc-tags");

        if (titleEl && info.title)   titleEl.textContent = info.title;
        if (subEl && info.subtitle)  subEl.textContent   = info.subtitle;
        if (textEl && info.text)     textEl.textContent  = info.text;

        if (tagsEl && Array.isArray(info.tags)) {
          tagsEl.innerHTML = "";
          info.tags.forEach(t => {
            const span = document.createElement("span");
            span.className = "tag";
            span.textContent = t;
            tagsEl.appendChild(span);
          });
        }
      } catch (err) {
        console.error("L·ªói load LinhVuc:", err);
      }
    }

    /* ========= 4. ƒê√ÄO T·∫†O (module=daotao) ========= */
    async function loadDaoTao() {
      try {
        const res  = await fetch(API_URL + "?module=daotao");
        const data = await res.json();
        const info = data.info || data;

        const titleEl = document.getElementById("daotao-title");
        const subEl   = document.getElementById("daotao-sub");
        const listEl  = document.getElementById("daotao-list");

        if (titleEl && info.title)   titleEl.textContent = info.title;
        if (subEl && info.subtitle)  subEl.textContent   = info.subtitle;

        if (listEl && Array.isArray(info.items)) {
          listEl.innerHTML = "";
          info.items.forEach(txt => {
            const li = document.createElement("li");
            li.textContent = txt;
            listEl.appendChild(li);
          });
        }
      } catch (err) {
        console.error("L·ªói load DaoTao:", err);
      }
    }

    /* ========= 5. ·∫§N PH·∫®M (module=anpham) ========= */
    async function loadAnPham() {
      try {
        const res  = await fetch(API_URL + "?module=anpham");
        const data = await res.json();
        const info = data.info || data;

        const titleEl = document.getElementById("anpham-title");
        const subEl   = document.getElementById("anpham-sub");
        const listEl  = document.getElementById("anpham-list");

        if (titleEl && info.title)   titleEl.textContent = info.title;
        if (subEl && info.subtitle)  subEl.textContent   = info.subtitle;

        if (listEl && Array.isArray(info.items)) {
          listEl.innerHTML = "";
          info.items.forEach(txt => {
            const li = document.createElement("li");
            li.textContent = txt;
            listEl.appendChild(li);
          });
        }
      } catch (err) {
        console.error("L·ªói load AnPham:", err);
      }
    }

    /* ========= G·ª¨I FORM LI√äN H·ªÜ (module=contact) ========= */
    function initContactForm() {
      const form      = document.getElementById("contact-form");
      const nameEl    = document.getElementById("name");
      const emailEl   = document.getElementById("email");
      const messageEl = document.getElementById("message");

      if (!form) return;

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const name    = (nameEl?.value || "").trim();
        const email   = (emailEl?.value || "").trim();
        const message = (messageEl?.value || "").trim();

        if (!name || !email || !message) {
          alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß H·ªç t√™n, Email v√† N·ªôi dung.");
          return;
        }

        try {
          const res = await fetch(API_URL, {
            method: "POST",
            body: new URLSearchParams({
              module: "contact",
              name,
              email,
              message
            })
          });

          const data = await res.json();

          if (data.success) {
            alert("ARiHA ƒë√£ nh·∫≠n ƒë∆∞·ª£c th√¥ng tin c·ªßa b·∫°n. Xin c·∫£m ∆°n!");
            form.reset();
          } else {
            console.error("L·ªói backend:", data);
            alert("G·ª≠i kh√¥ng th√†nh c√¥ng. Vui l√≤ng th·ª≠ l·∫°i sau.");
          }
        } catch (err) {
          console.error("L·ªói g·ª≠i form li√™n h·ªá:", err);
          alert("C√≥ l·ªói khi g·ª≠i d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i.");
        }
      });
    }

    /* ========= HI·ªÜU ·ª®NG ƒê·∫æM S·ªê HERO ========= */
    function animateCounter(element, duration = 2000) {
      const rawValue = element.dataset.value;
      const targetNumber = parseInt(rawValue, 10);

      // N·∫øu kh√¥ng ph·∫£i s·ªë (v√≠ d·ª•: "NCKH") ‚Üí hi·ªÉn th·ªã nguy√™n vƒÉn, kh√¥ng animate
      if (isNaN(targetNumber)) {
        element.textContent = rawValue || "";
        return;
      }

      let current = 0;
      const stepTime = 30; // ms
      const increment = targetNumber / (duration / stepTime);

      const timer = setInterval(() => {
        current += increment;
        if (current >= targetNumber) {
          clearInterval(timer);
          element.textContent = targetNumber + "+"; // th√™m d·∫•u +
        } else {
          element.textContent = Math.floor(current);
        }
      }, stepTime);
    }

    /* ========= HERO STATS (module=hero) ========= */
    async function loadHeroStats() {
      const box = document.getElementById("hero-stats");
      if (!box) return;

      try {
        const res  = await fetch(API_URL + "?module=hero");
        const data = await res.json();
        const items = data.items || [];

        if (!items.length) return;

        box.innerHTML = "";
        items.forEach(it => {
          const item = document.createElement("div");
          item.className = "hero-stat-item";

          item.innerHTML = `
            <div class="hero-stat-number" data-value="${it.number || ""}">0</div>
            <div>
              ${it.line1 || ""}
              ${it.line2 ? "<br/>" + it.line2 : ""}
            </div>
          `;

          box.appendChild(item);
        });

        // ch·∫°y animation sau khi ƒë√£ render xong
        document.querySelectorAll(".hero-stat-number").forEach(el => {
          animateCounter(el);
        });

      } catch (err) {
        console.error("L·ªói load HeroStats:", err);
      }
    }

    // G·ªçi t·∫•t c·∫£ khi trang load
    window.addEventListener("load", () => {
      loadNews();
      loadEcosystem();
      loadGioiThieu();
      loadLinhVuc();
      loadDaoTao();
      loadAnPham();
      loadHeroStats();
      initContactForm();
    });
  </script>
