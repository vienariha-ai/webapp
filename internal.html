<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Vi·ªán ARiHA ‚Äì Dashboard nghi√™n c·ª©u</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg: #eef3ff;
      --bg-card: #ffffff;
      --primary: #2563eb;
      --primary-soft: #e0ecff;
      --primary-dark: #1e40af;
      --accent: #22c55e;
      --text-main: #0f172a;
      --text-muted: #6b7280;
      --border: #e5e7eb;
      --radius-lg: 20px;
      --radius-md: 12px;
      --radius-pill: 999px;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.12);
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #dbeafe 0, #eef2ff 45%, #f9fafb 100%);
      min-height: 100vh;
      color: var(--text-main);
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* ==== TOPBAR ==== */
    .topbar {
      max-width: 1180px;
      margin: 18px auto 10px;
      padding: 10px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: contain;
      background: #fff;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.08);
    }

    .brand-title {
      display: flex;
      flex-direction: column;
    }

    .brand-title span:first-child {
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--primary-dark);
    }

    .brand-title span:last-child {
      font-size: 11px;
      color: var(--text-muted);
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 11px;
      color: var(--text-muted);
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .pill {
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      background: rgba(37, 99, 235, 0.08);
      color: var(--primary-dark);
      font-weight: 500;
    }

    /* ==== MAIN LAYOUT ==== */
    .wrapper {
      max-width: 1180px;
      margin: 0 auto 30px;
      padding: 0 18px 26px;
    }

    .page-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .page-subtitle {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 14px;
    }

    .page-note {
      font-size: 12px;
      color: #374151;
      margin-bottom: 16px;
    }

    .page-note span {
      background: rgba(37, 99, 235, 0.09);
      color: var(--primary-dark);
      border-radius: var(--radius-pill);
      padding: 3px 10px;
      font-weight: 500;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 230px) minmax(0, 1fr);
      gap: 18px;
      align-items: flex-start;
    }

    /* ==== SIDEBAR ==== */
    .sidebar {
      background: radial-gradient(circle at top left, #020617 0, #020617 40%, #0f172a 100%);
      border-radius: var(--radius-lg);
      padding: 16px 14px 14px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.6);
      color: #e5e7eb;
      position: sticky;
      top: 20px;
    }

    .sidebar-heading {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #9ca3af;
      margin-bottom: 6px;
    }

    .sidebar-sub {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 12px;
    }

    .sidebar-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .sidebar-item {
      padding: 8px 10px;
      border-radius: 14px;
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      border: 1px solid transparent;
      transition: all 0.15s ease;
    }

    .sidebar-item small {
      display: block;
      font-size: 10px;
      color: #9ca3af;
    }

    .sidebar-item span.icon {
      font-size: 15px;
      opacity: 0.9;
    }

    .sidebar-item:hover {
      background: rgba(30, 64, 175, 0.9);
      border-color: rgba(129, 140, 248, 0.9);
    }

    .sidebar-item.active {
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      border-color: transparent;
      box-shadow: 0 12px 30px rgba(37, 99, 235, 0.75);
    }

    /* ==== CARD ==== */
    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      padding: 14px 16px 18px;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .card-header-main h2 {
      font-size: 15px;
      margin-bottom: 2px;
    }

    .card-header-main p {
      font-size: 12px;
      color: var(--text-muted);
    }

    .card-header-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .btn-primary {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      border-radius: var(--radius-pill);
      color: #f9fafb;
      border: none;
      font-size: 11px;
      font-weight: 500;
      padding: 6px 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
    }

    .btn-primary span.icon {
      font-size: 14px;
    }

    .badge-soft {
      border-radius: var(--radius-pill);
      padding: 4px 9px;
      font-size: 11px;
      background: #ecfdf5;
      color: #047857;
    }

    .filters-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
    }

    .filters-row select {
      border-radius: var(--radius-pill);
      border: 1px solid var(--border);
      background: #f9fafb;
      padding: 6px 24px 6px 10px;
      font-size: 11px;
      color: #374151;
    }

    .filters-row select:focus {
      outline: 2px solid rgba(37, 99, 235, 0.35);
      outline-offset: 1px;
    }

    .card-note {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11.5px;
    }

    thead {
      background: #f9fafb;
    }

    th,
    td {
      padding: 7px 8px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      vertical-align: top;
    }

    th {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 10px;
      color: #6b7280;
    }

    tbody tr:hover {
      background: #f3f4ff;
    }

    .status-pill {
      padding: 4px 8px;
      border-radius: var(--radius-pill);
      font-size: 10px;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .status-done {
      background: #ecfdf3;
      color: #15803d;
      border: 1px solid #bbf7d0;
    }

    .status-review {
      background: #fef3c7;
      color: #92400e;
      border: 1px solid #fed7aa;
    }

    .status-ongoing {
      background: #dbeafe;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
    }

    .btn-link {
      font-size: 11px;
      color: #2563eb;
      font-weight: 500;
    }

    .btn-link:hover {
      text-decoration: underline;
    }

    .panel {
      display: none;
    }

    .panel.active {
      display: block;
    }

    /* ==== RESPONSIVE ==== */
    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
      .sidebar {
        position: static;
      }
    }

    @media (max-width: 600px) {
      .topbar {
        flex-direction: column;
        align-items: flex-start;
      }
      th,
      td {
        padding: 5px 6px;
      }
    }
  </style>
</head>
<body>
  <!-- TOPBAR -->
  <header class="topbar">
    <!-- CLICK = v·ªÅ index.html -->
    <a href="index.html" class="brand">
      <img src="logo-ariha.png" alt="Logo Vi·ªán ARiHA" />
      <div class="brand-title">
        <span>Vi·ªán ARiHA</span>
        <span>Vi·ªán Nghi√™n c·ª©u ·ª®ng d·ª•ng Khoa h·ªçc S·ª©c kh·ªèe &amp; L√£o h√≥a</span>
      </div>
    </a>
    <div class="topbar-right">
      <div>Dashboard nghi√™n c·ª©u (demo n·ªôi b·ªô)</div>
      <div class="pill">NƒÉm <span id="year-pill"></span></div>
      <!-- N√öT V·ªÄ TRANG CH·ª¶ -->
      <button class="btn-primary" type="button" onclick="window.location.href='index.html'">
        <span class="icon">‚Üê</span> V·ªÅ trang ch·ªß
      </button>
    </div>
  </header>

  <main class="wrapper">
    <h1 class="page-title">N·ªôi b·ªô ‚Äì Dashboard nghi√™n c·ª©u (demo)</h1>
    <p class="page-subtitle">
      Khu v·ª±c qu·∫£n l√Ω ƒë·ªÅ t√†i, c√¥ng b·ªë, h·ªôi th·∫£o, th·∫©m ƒë·ªãnh v√† ƒëi·ªÉm s·ªë NCKH. Giao di·ªán n√†y d√πng
      d·ªØ li·ªáu t·ª´ Google Sheets (th√¥ng qua Google Apps Script Web App).
    </p>
    <p class="page-note">
      <span>G·ª£i √Ω tri·ªÉn khai th·ª±c t·∫ø:</span> M·ªói module t∆∞∆°ng ·ª©ng v·ªõi m·ªôt sheet (DeTai, CongBo, HoiThao, ThamDinh, KPI_NCKH).
    </p>

    <div class="layout">
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="sidebar-heading">Module qu·∫£n l√Ω</div>
        <div class="sidebar-sub">Ch·ªçn ph√¢n h·ªá c·∫ßn xem chi ti·∫øt</div>

        <div class="sidebar-list">
          <div class="sidebar-item active" data-target="panel-detai">
            <div>
              ƒê·ªÅ t√†i nghi√™n c·ª©u
              <small>Danh m·ª•c &amp; ti·∫øn ƒë·ªô</small>
            </div>
            <span class="icon">üìö</span>
          </div>

          <div class="sidebar-item" data-target="panel-congbo">
            <div>
              ƒê·ªÅ t√†i c√¥ng b·ªë
              <small>T·∫°p ch√≠ trong &amp; ngo√†i n∆∞·ªõc</small>
            </div>
            <span class="icon">üì∞</span>
          </div>

          <div class="sidebar-item" data-target="panel-hoithao">
            <div>
              H·ªôi th·∫£o / Kh√≥a h·ªçc
              <small>L·ªãch &amp; ƒëƒÉng k√Ω</small>
            </div>
            <span class="icon">üéì</span>
          </div>

          <div class="sidebar-item" data-target="panel-thamdinh">
            <div>
              Th·∫©m ƒë·ªãnh ƒë·ªÅ t√†i
              <small>Phi·∫øu &amp; ƒëi·ªÉm</small>
            </div>
            <span class="icon">üìù</span>
          </div>

          <div class="sidebar-item" data-target="panel-diemso">
            <div>
              ƒêi·ªÉm s·ªë &amp; KPI NCKH
              <small>T·ªïng h·ª£p theo c√° nh√¢n</small>
            </div>
            <span class="icon">üìà</span>
          </div>
        </div>
      </aside>

      <!-- MAIN CARD -->
      <section class="card">
        <!-- PANEL: ƒê·ªÄ T√ÄI -->
        <div id="panel-detai" class="panel active">
          <div class="card-header">
            <div class="card-header-main">
              <h2>Qu·∫£n l√Ω ƒë·ªÅ t√†i nghi√™n c·ª©u</h2>
              <p>Danh m·ª•c ƒë·ªÅ t√†i, lo·∫°i h√¨nh nghi√™n c·ª©u, ch·ªß nhi·ªám &amp; tr·∫°ng th√°i (sheet ‚ÄúDeTai‚Äù).</p>
            </div>
            <div class="card-header-actions">
              <button class="btn-primary" type="button">
                <span class="icon">üîó</span>K·∫øt n·ªëi Google Sheets
              </button>
              <span class="badge-soft">D·ªØ li·ªáu demo, ƒë√£ s·∫µn s√†ng k·∫øt n·ªëi th·∫≠t</span>
            </div>
          </div>

          <div class="filters-row">
            <select id="detai-year-filter">
              <option value="">NƒÉm: T·∫•t c·∫£</option>
            </select>
            <select id="detai-status-filter">
              <option value="">Tr·∫°ng th√°i: T·∫•t c·∫£</option>
            </select>
            <select id="detai-type-filter">
              <option value="">Lo·∫°i nghi√™n c·ª©u: T·∫•t c·∫£</option>
            </select>
          </div>
          <div class="card-note">
            D·ªØ li·ªáu hi·ªÉn th·ªã t·ª´ sheet ‚ÄúDeTai‚Äù. B·ªô l·ªçc ho·∫°t ƒë·ªông ·ªü ph√≠a front-end, kh√¥ng c·∫ßn t·∫£i l·∫°i trang.
          </div>
 	    <table class="dash-table">
                <thead>
                  <colgroup>
			<col style="width: 5%;">   <!-- M√£ s·ªë -->
			<col style="width: 40%;">  <!-- T√™n ƒë·ªÅ t√†i -->
			<col style="width: 15%;">  <!-- Lo·∫°i nghi√™n c·ª©u -->
			<col style="width: 20%;">  <!-- Ch·ªß nhi·ªám -->
			<col style="width: 15%;">   <!-- Tr·∫°ng th√°i -->
			<col style="width: 5%;">   <!-- H·ªì s∆° -->
	          </colgroup>
		  <tr>
                    <th>M√£ s·ªë</th>
                    <th>T√™n ƒë·ªÅ t√†i</th>
                    <th>Lo·∫°i nghi√™n c·ª©u</th>
                    <th>Ch·ªß nhi·ªám</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>H·ªì s∆°</th>
                  </tr>
	        </thead>
        	<tbody id="detai-body"></tbody>
	    </table>
        </div>

        <!-- PANEL: C√îNG B·ªê -->
        <div id="panel-congbo" class="panel">
          <div class="card-header">
            <div class="card-header-main">
              <h2>ƒê·ªÅ t√†i c√¥ng b·ªë ‚Äì B√†i b√°o khoa h·ªçc</h2>
              <p>D·ªØ li·ªáu c√¥ng b·ªë khoa h·ªçc (sheet ‚ÄúCongBo‚Äù), c√≥ DOI &amp; ch·ªâ s·ªë uy t√≠n.</p>
            </div>
            <div class="card-header-actions">
              <span class="badge-soft">Theo d√µi t·∫°p ch√≠ trong n∆∞·ªõc &amp; qu·ªëc t·∫ø</span>
            </div>
          </div>

          <div class="filters-row">
            <select id="congbo-year-filter">
              <option value="">NƒÉm: T·∫•t c·∫£</option>
            </select>
            <select id="congbo-type-filter">
              <option value="">Lo·∫°i t·∫°p ch√≠: T·∫•t c·∫£</option>
            </select>
          </div>
          <div class="card-note">
            C√≥ th·ªÉ m·ªü r·ªông th√™m b·ªô l·ªçc theo IF, Scopus, WoS n·∫øu b·ªï sung c·ªôt t∆∞∆°ng ·ª©ng trong Google Sheets.
          </div>
          <table class="dash-table">
                <thead>
                  <colgroup>
			<col style="width: 5%;">   <!-- NƒÉm -->
			<col style="width: 45%;">  <!-- T√™n c√¥ng b·ªë -->
			<col style="width: 15%;">  <!-- Lo·∫°i t·∫°p ch√≠ -->
			<col style="width: 15%;">  <!-- T·∫°p ch√≠ -->
			<col style="width: 5%;">   <!-- DOI -->
			<col style="width: 10%;">   <!-- Ch·ªâ s·ªë uy t√≠n -->
			<col style="width: 5%;">   <!-- Link -->
	          </colgroup>
		  <tr>
                    <th>NƒÉm</th>
                    <th>T√™n c√¥ng b·ªë</th>
                    <th>Lo·∫°i t·∫°p ch√≠</th>
                    <th>T·∫°p ch√≠</th>
                    <th>DOI</th>
                    <th>Ch·ªâ s·ªë uy t√≠n</th>
                    <th>Link</th>
                  </tr>
                </thead>
                <tbody id="congbo-body">
                  <!-- JS render -->
                </tbody>
              </table>

        </div>

        <!-- PANEL: H·ªòI TH·∫¢O -->
        <div id="panel-hoithao" class="panel">
          <div class="card-header">
            <div class="card-header-main">
              <h2>H·ªôi th·∫£o / Kh√≥a h·ªçc / Sinh ho·∫°t khoa h·ªçc</h2>
              <p>L·ªãch ch∆∞∆°ng tr√¨nh, lo·∫°i h√¨nh &amp; th√¥ng tin ƒëƒÉng k√Ω (sheet ‚ÄúHoiThao‚Äù).</p>
            </div>
            <div class="card-header-actions">
              <span class="badge-soft">K·∫øt h·ª£p ƒêTLT, h·ªôi ngh·ªã, SHKH</span>
            </div>
          </div>

          <div class="filters-row">
            <select id="hoithao-year-filter">
              <option value="">NƒÉm: T·∫•t c·∫£</option>
            </select>
            <select id="hoithao-type-filter">
              <option value="">Lo·∫°i ch∆∞∆°ng tr√¨nh: T·∫•t c·∫£</option>
            </select>
          </div>
          <div class="card-note">
            M·ªói d√≤ng t∆∞∆°ng ·ª©ng m·ªôt h·ªôi th·∫£o/kh√≥a h·ªçc, c√≥ th·ªÉ g·∫Øn link poster ho·∫∑c form ƒëƒÉng k√Ω.
          </div>

         
	 <table>
            <thead>
              <tr>
                <th style="width:95px;">Ng√†y</th>
                <th>Ch∆∞∆°ng tr√¨nh</th>
                <th style="width:150px;">Lo·∫°i</th>
                <th style="width:140px;">ƒêƒÉng k√Ω / S·ªë l∆∞·ª£ng</th>
                <th style="width:85px;">Chi ti·∫øt</th>
              </tr>
            </thead>
            <tbody id="hoithao-body"></tbody>
          </table>
        </div>

        <!-- PANEL: TH·∫®M ƒê·ªäNH (m√¥ t·∫£) -->
        <div id="panel-thamdinh" class="panel">
          <div class="card-header">
            <div class="card-header-main">
              <h2>Th·∫©m ƒë·ªãnh ƒë·ªÅ t√†i ‚Äì Phi·∫øu &amp; ƒëi·ªÉm</h2>
              <p>Module th·∫©m ƒë·ªãnh s·ª≠ d·ª•ng sheet ‚ÄúThamDinh‚Äù ƒë·ªÉ l∆∞u ph·∫£n bi·ªán v√† ƒëi·ªÉm s·ªë.</p>
            </div>
            <div class="card-header-actions">
              <span class="badge-soft">Script c√≥ th·ªÉ t·ª± t√≠nh ƒëi·ªÉm trung b√¨nh</span>
            </div>
          </div>
          <div class="card-note">
            Trong Apps Script, b·∫°n ƒë√£ c√≥ h√†m t√≠nh <strong>DiemTB</strong> v√† ph√¢n lo·∫°i tr·∫°ng th√°i. Panel n√†y c√≥ th·ªÉ
            m·ªü r·ªông th√†nh b·∫£ng chi ti·∫øt k·∫øt qu·∫£ th·∫©m ƒë·ªãnh cho t·ª´ng ƒë·ªÅ t√†i.
          </div>
        </div>

        <!-- PANEL: ƒêI·ªÇM S·ªê & KPI (m√¥ t·∫£) -->
        <div id="panel-diemso" class="panel">
          <div class="card-header">
            <div class="card-header-main">
              <h2>ƒêi·ªÉm s·ªë &amp; KPI NCKH</h2>
              <p>ƒêi·ªÉm khoa h·ªçc t·ªïng h·ª£p theo t·ª´ng c√° nh√¢n, ƒë·ªçc t·ª´ sheet ‚ÄúKPI_NCKH‚Äù.</p>
            </div>
            <div class="card-header-actions">
              <span class="badge-soft">T√≠nh ƒëi·ªÉm t·ª± ƒë·ªông b·∫±ng Apps Script</span>
            </div>
          </div>
          <div class="card-note">
            B·∫°n ƒë√£ c√≥ h√†m <code>calculateNCKHPoints()</code> ƒë·ªÉ t√≠nh ƒëi·ªÉm ƒë·ªÅ t√†i &amp; b√†i b√°o theo tr·ªçng s·ªë. T·ª´ d·ªØ li·ªáu n√†y
            c√≥ th·ªÉ d·ª±ng b·∫£ng x·∫øp h·∫°ng NCKH, thanh ti·∫øn tr√¨nh theo ch·ªâ ti√™u nƒÉm, v.v.
          </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    // c·∫≠p nh·∫≠t nƒÉm
    const year = new Date().getFullYear();
    document.getElementById("year-pill").textContent = year;

    // THAY B·∫∞NG URL WEB APP C·ª¶A B·∫†N
    const API_URL = "https://script.google.com/macros/s/AKfycbwiAVTqJCx-DUdMDF_LePfKHC3uWu_VYMYhaWtybzXqNfHRp9KlYcFDW_BnA7NZgMY3/exec";

    // l∆∞u d·ªØ li·ªáu g·ªëc
    let detaiAll = [];
    let congboAll = [];
    let hoithaoAll = [];

    // helper: class tr·∫°ng th√°i
    function statusClass(trangThai) {
      if (!trangThai) return "";
      const t = String(trangThai).toLowerCase();
      if (t.includes("nghi·ªám thu") || t.includes("ho√†n th√†nh")) return "status-done";
      if (t.includes("th·∫©m ƒë·ªãnh") || t.includes("x√©t duy·ªát")) return "status-review";
      return "status-ongoing";
    }

    /* ===== ƒê·ªÄ T√ÄI ===== */

    function getYearFromMaSo(maSo) {
      if (!maSo) return "";
      const s = String(maSo);
      const m4 = s.match(/(20\d{2})/);
      if (m4) return m4[1];
      const m2 = s.match(/DT-?(\d{2})-/i);
      if (m2) return "20" + m2[1];
      return "";
    }

    async function loadDetai() {
      if (!API_URL || API_URL === "YOUR_WEB_APP_URL_HERE") return;
      try {
        const res = await fetch(API_URL + "?module=detai");
        const data = await res.json();
        detaiAll = data.items || [];
        buildDetaiFilters();
        applyDetaiFilters();
      } catch (e) {
        console.error("L·ªói load ƒë·ªÅ t√†i:", e);
      }
    }

    function buildDetaiFilters() {
      const yearSel = document.getElementById("detai-year-filter");
      const stSel = document.getElementById("detai-status-filter");
      const typeSel = document.getElementById("detai-type-filter");
      if (!yearSel || !stSel || !typeSel) return;

      yearSel.length = 1;
      stSel.length = 1;
      typeSel.length = 1;

      const years = new Set();
      const statuses = new Set();
      const types = new Set();

      detaiAll.forEach(it => {
        const y = getYearFromMaSo(it.maSo);
        if (y) years.add(y);
        if (it.trangThai) statuses.add(String(it.trangThai).trim());
        if (it.loaiNghienCuu) types.add(String(it.loaiNghienCuu).trim());
      });

      Array.from(years).sort().forEach(y => {
        const o = document.createElement("option");
        o.value = y;
        o.textContent = "NƒÉm: " + y;
        yearSel.appendChild(o);
      });

      Array.from(statuses).sort().forEach(s => {
        const o = document.createElement("option");
        o.value = s;
        o.textContent = s;
        stSel.appendChild(o);
      });

      Array.from(types).sort().forEach(t => {
        const o = document.createElement("option");
        o.value = t;
        o.textContent = t;
        typeSel.appendChild(o);
      });

      yearSel.onchange = applyDetaiFilters;
      stSel.onchange = applyDetaiFilters;
      typeSel.onchange = applyDetaiFilters;
    }

    function applyDetaiFilters() {
      const yearSel = document.getElementById("detai-year-filter");
      const stSel = document.getElementById("detai-status-filter");
      const typeSel = document.getElementById("detai-type-filter");
      if (!yearSel || !stSel || !typeSel) return;

      const yVal = yearSel.value;
      const stVal = stSel.value;
      const tVal = typeSel.value;

      let list = detaiAll.slice();

      if (yVal) {
        list = list.filter(it => getYearFromMaSo(it.maSo) === yVal);
      }
      if (stVal) {
        list = list.filter(
          it => String(it.trangThai || "").toLowerCase() === stVal.toLowerCase()
        );
      }
      if (tVal) {
        list = list.filter(
          it => String(it.loaiNghienCuu || "").toLowerCase() === tVal.toLowerCase()
        );
      }

      renderDetai(list);
    }

    function renderDetai(list) {
      const tbody = document.getElementById("detai-body");
      if (!tbody) return;
      tbody.innerHTML = "";

      list.forEach(it => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${it.maSo || ""}</td>
          <td>${it.tenDeTai || ""}</td>
          <td>${it.loaiNghienCuu || ""}</td>
          <td>${it.chuNhiem || ""}</td>
          <td><span class="status-pill ${statusClass(it.trangThai)}">${it.trangThai || ""}</span></td>
          <td>${
            it.link
              ? `<a class="btn-link" href="${it.link}" target="_blank">Xem h·ªì s∆°</a>`
              : ""
          }</td>`;
        tbody.appendChild(tr);
      });
    }

    /* ===== C√îNG B·ªê ===== */

    async function loadCongbo() {
      if (!API_URL || API_URL === "YOUR_WEB_APP_URL_HERE") return;
      try {
        const res = await fetch(API_URL + "?module=congbo");
        const data = await res.json();
        congboAll = data.items || [];
        buildCongboFilters();
        applyCongboFilters();
      } catch (e) {
        console.error("L·ªói load c√¥ng b·ªë:", e);
      }
    }

    function buildCongboFilters() {
      const yearSel = document.getElementById("congbo-year-filter");
      const typeSel = document.getElementById("congbo-type-filter");
      if (!yearSel || !typeSel) return;

      yearSel.length = 1;
      typeSel.length = 1;

      const years = new Set();
      const types = new Set();

      congboAll.forEach(it => {
        if (it.nam) years.add(String(it.nam));
        if (it.loaiTapChi) types.add(String(it.loaiTapChi).trim());
      });

      Array.from(years).sort().forEach(y => {
        const o = document.createElement("option");
        o.value = y;
        o.textContent = "NƒÉm: " + y;
        yearSel.appendChild(o);
      });
      Array.from(types).sort().forEach(t => {
        const o = document.createElement("option");
        o.value = t;
        o.textContent = t;
        typeSel.appendChild(o);
      });

      yearSel.onchange = applyCongboFilters;
      typeSel.onchange = applyCongboFilters;
    }

    function applyCongboFilters() {
      const yearSel = document.getElementById("congbo-year-filter");
      const typeSel = document.getElementById("congbo-type-filter");
      if (!yearSel || !typeSel) return;

      const yVal = yearSel.value;
      const tVal = typeSel.value;

      let list = congboAll.slice();

      if (yVal) list = list.filter(it => String(it.nam) === yVal);
      if (tVal)
        list = list.filter(
          it => String(it.loaiTapChi || "").toLowerCase() === tVal.toLowerCase()
        );

      renderCongbo(list);
    }

    function renderCongbo(list) {
      const tbody = document.getElementById("congbo-body");
      if (!tbody) return;
      tbody.innerHTML = "";

      list.forEach(it => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${it.nam || ""}</td>
          <td>${it.tieuDe || ""}</td>
          <td>${it.loaiTapChi || ""}</td>
          <td>${it.tenTapChi || ""}</td>
          <td>${it.doi || ""}</td>
          <td>${it.chiSoUyTin || ""}</td>
          <td>${
            it.link
              ? `<a class="btn-link" href="${it.link}" target="_blank">Xem b√†i</a>`
              : ""
          }</td>`;
        tbody.appendChild(tr);
      });
    }

    /* ===== H·ªòI TH·∫¢O ===== */

    function getYearFromDateStr(str) {
      if (!str) return "";
      const m = String(str).match(/(\d{4})/);
      return m ? m[1] : "";
    }

    async function loadHoithao() {
      if (!API_URL || API_URL === "YOUR_WEB_APP_URL_HERE") return;
      try {
        const res = await fetch(API_URL + "?module=hoithao");
        const data = await res.json();
        hoithaoAll = data.items || [];
        buildHoithaoFilters();
        applyHoithaoFilters();
      } catch (e) {
        console.error("L·ªói load h·ªôi th·∫£o:", e);
      }
    }

    function buildHoithaoFilters() {
      const yearSel = document.getElementById("hoithao-year-filter");
      const typeSel = document.getElementById("hoithao-type-filter");
      if (!yearSel || !typeSel) return;

      yearSel.length = 1;
      typeSel.length = 1;

      const years = new Set();
      const types = new Set();

      hoithaoAll.forEach(it => {
        const y = getYearFromDateStr(it.ngay);
        if (y) years.add(y);
        if (it.loai) types.add(String(it.loai).trim());
      });

      Array.from(years).sort().forEach(y => {
        const o = document.createElement("option");
        o.value = y;
        o.textContent = "NƒÉm: " + y;
        yearSel.appendChild(o);
      });
      Array.from(types).sort().forEach(t => {
        const o = document.createElement("option");
        o.value = t;
        o.textContent = t;
        typeSel.appendChild(o);
      });

      yearSel.onchange = applyHoithaoFilters;
      typeSel.onchange = applyHoithaoFilters;
    }

    function applyHoithaoFilters() {
      const yearSel = document.getElementById("hoithao-year-filter");
      const typeSel = document.getElementById("hoithao-type-filter");
      if (!yearSel || !typeSel) return;

      const yVal = yearSel.value;
      const tVal = typeSel.value;

      let list = hoithaoAll.slice();

      if (yVal) list = list.filter(it => getYearFromDateStr(it.ngay) === yVal);
      if (tVal)
        list = list.filter(
          it => String(it.loai || "").toLowerCase() === tVal.toLowerCase()
        );

      renderHoithao(list);
    }

    function renderHoithao(list) {
      const tbody = document.getElementById("hoithao-body");
      if (!tbody) return;
      tbody.innerHTML = "";

      list.forEach(it => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${it.ngay || ""}</td>
          <td>${it.chuongTrinh || ""}</td>
          <td>${it.loai || ""}</td>
          <td>${it.dangKy || ""}</td>
          <td>${
            it.link
              ? `<a class="btn-link" href="${it.link}" target="_blank">Chi ti·∫øt</a>`
              : ""
          }</td>`;
        tbody.appendChild(tr);
      });
    }

    /* ===== CHUY·ªÇN PANEL ===== */

    const sidebarItems = document.querySelectorAll(".sidebar-item");
    const panels = document.querySelectorAll(".panel");

    sidebarItems.forEach(item => {
      item.addEventListener("click", () => {
        sidebarItems.forEach(i => i.classList.remove("active"));
        item.classList.add("active");

        const target = item.getAttribute("data-target");
        panels.forEach(p => {
          p.classList.toggle("active", p.id === target);
        });

        if (target === "panel-detai") loadDetai();
        if (target === "panel-congbo") loadCongbo();
        if (target === "panel-hoithao") loadHoithao();
      });
    });

    // load ƒë·ªÅ t√†i l·∫ßn ƒë·∫ßu
    window.addEventListener("load", loadDetai);
  </script>
</body>
</html>

